# Sessão de Desenvolvimento — 17/02/2026

## Resumo das Alterações

---

### 1. Servidor Backend — Reinicialização

**Problema:** Servidor uvicorn estava morto com entradas TCP fantasmas no netstat (PID 3176 aparecia mas não existia como processo). O celular (`192.168.100.120`) tentava conectar em conexões antigas mortas.

**Solução:**
- Identificados e mortos processos travados (PIDs 26260, 33088)
- Porta 8000 liberada completamente
- Servidor reiniciado limpo (PID 31560) — respondendo HTTP 401 em < 1s
- Criado `start_server.bat` na raiz do projeto para reinicializações futuras

**Para iniciar o servidor:**
```
start_server.bat
```
Ou manualmente:
```
cd backend
..\venv\Scripts\activate
python -m uvicorn app.main:app --host 0.0.0.0 --port 8000
```

---

### 2. Fix: Teclado ocultando input no Step 1 do Wizard

**Arquivo:** `mobile/app/products/wizard.tsx`

**Problema:** No modo Manual do Step 1, o teclado abria sobre o campo "Nome do Produto" sem rolar a tela.

**Correções:**
- Substituído `<View style={styles.content}>` por `<KeyboardAvoidingView behavior="padding" (iOS) / "height" (Android)>`

**Arquivo:** `mobile/components/products/WizardStep1.tsx`

- `keyboardShouldPersistTaps="handled"` — botões funcionam mesmo com teclado aberto
- `keyboardDismissMode="interactive"` — teclado fecha ao arrastar para baixo
- `paddingBottom: 320` — espaço extra para o botão "Continuar" ficar visível acima do teclado

---

### 3. Fix: TypeError no Catálogo de Produtos

**Arquivo:** `mobile/components/products/WizardStep1.tsx`

**Problema:** `TypeError: product.price.toFixed is not a function` — alguns produtos do catálogo têm `price = null/undefined`.

**Correção:**
```tsx
// Antes (quebrava com price null/undefined):
{product.price > 0 && (
  <Text>{product.price.toFixed(2)}</Text>
)}

// Depois (seguro):
{product.price != null && product.price > 0 && (
  <Text>{Number(product.price).toFixed(2).replace('.', ',')}</Text>
)}
```

---

### 4. Redesign UX do Catálogo de Produtos

**Arquivo:** `mobile/components/products/WizardStep1.tsx`

**Problemas:**
- Botão "Usar este produto" ficava no final da lista (fora da tela)
- Produto selecionado aparecia borrado/semitransparente

**Novo design:**
- **Banner de seleção fixo no topo** — quando produto é selecionado, aparece banner verde com nome + botão "Usar →" imediatamente visível
- **Radio button circular** (○ → ● azul) em vez de ícone de cubo
- **Toggle de seleção** — toque no item selecionado o deseleciona
- **Dica contextual** — "Toque em um produto para selecioná-lo" quando nada selecionado
- **Loading inline** (horizontal) em vez de bloco grande
- Campo de busca com bordas arredondadas

---

### 5. SKU com Auto-Regeneração Reativa

**Arquivo:** `mobile/components/products/WizardStep2.tsx`

**Problema:** O SKU só era regenerado ao clicar manualmente no botão ↻.

**Implementação:**
- Novo estado `skuManuallyEdited: boolean`
- `useEffect` que regenera o SKU automaticamente quando `nome`, `marca`, `cor` ou `tamanho` mudam
- Se o usuário digitar diretamente no campo SKU → `skuManuallyEdited = true` → auto-regeneração desativada
- Botão ↻ reseta `skuManuallyEdited = false` e reativa o automático
- Hint dinâmico:
  - Modo auto: `"SKU atualizado automaticamente ao editar nome, marca, cor ou tamanho."`
  - Modo manual: `"SKU editado manualmente. Toque em ↻ para voltar ao automático."`

---

## Arquivos Modificados

| Arquivo | Alteração |
|---------|-----------|
| `mobile/app/products/wizard.tsx` | KeyboardAvoidingView no content |
| `mobile/components/products/WizardStep1.tsx` | Fix teclado + Fix price.toFixed + Redesign catálogo |
| `mobile/components/products/WizardStep2.tsx` | Auto-regeneração de SKU |
| `start_server.bat` | Script para iniciar servidor (novo) |

---

## Estado do Projeto

- **Backend:** Rodando na porta 8000 (reiniciar com `start_server.bat` após reboot)
- **Mobile:** Expo Go conectado via LAN (`192.168.100.158:8000`)
- **Wizard de Produtos:** Step 1 (Identificar) e Step 2 (Confirmar) com melhorias de UX

---

## Próximos Passos Sugeridos

- Testar fluxo completo do wizard após reinicialização
- Verificar se o celular reconecta automaticamente ao servidor
- Continuar com outros itens do WIP.md
